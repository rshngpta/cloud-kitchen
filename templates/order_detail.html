{% extends 'base.html' %}

{% block title %}Order #{{ order.id }} - Cloud Kitchen{% endblock %}

{% block content %}
<h1>Order #{{ order.id }}</h1>

<div class="card">
    <h2>Order Information</h2>
    <p><strong>Status:</strong> {{ order.status }}</p>
    <p><strong>Payment Method:</strong> {{ order.payment_method }}</p>
    <p><strong>Payment Status:</strong> {{ order.payment_status }}</p>
    <p><strong>Total:</strong> ${{ "%.2f"|format(order.total_amount) }}</p>
    <p><strong>Created:</strong> {{ order.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
</div>

<div class="card">
    <h2>Customer Details</h2>
    <p><strong>Name:</strong> {{ order.customer_name }}</p>
    <p><strong>Email:</strong> {{ order.customer_email }}</p>
    <p><strong>Phone:</strong> {{ order.customer_phone }}</p>
    <p><strong>Address:</strong> {{ order.customer_address }}</p>
</div>

<h2>Order Items</h2>
<table>
    <thead>
        <tr>
            <th>Item</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        {% for item in order.items %}
        <tr>
            <td>{{ item.menu_item.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>${{ "%.2f"|format(item.price) }}</td>
            <td>${{ "%.2f"|format(item.quantity * item.price) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Update Status</h2>
<form action="{{ url_for('update_order_status', order_id=order.id) }}" method="post" style="display: inline;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <select name="status">
        <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
        <option value="confirmed" {% if order.status == 'confirmed' %}selected{% endif %}>Confirmed</option>
        <option value="preparing" {% if order.status == 'preparing' %}selected{% endif %}>Preparing</option>
        <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
        <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
    </select>
    <button type="submit">Update Status</button>
</form>

<form action="{{ url_for('delete_order', order_id=order.id) }}" method="post" style="display: inline;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="btn-danger" onclick="return confirm('Are you sure you want to delete this order?');">Delete Order</button>
</form>

<p style="margin-top: 20px;">
    <a href="{{ url_for('orders') }}" class="btn">Back to Orders</a>
</p>
{% endblock %}

